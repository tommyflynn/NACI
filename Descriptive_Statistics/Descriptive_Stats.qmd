---
title: "Descriptive Statistics"
author: "Tommy Flynn"
format: 
  html:
    theme: solar
    toc: true
    code-tools: true
    code-fold: true
    code-copy: true
    code-block-bg: true
    code-block-border-left: "#31BAE9"
    number-sections: true
    page-layout: full
---

```{r setup, message=FALSE}
knitr::opts_chunk$set(error = TRUE,
                      tidy = TRUE,
                      tidy.opts = list(width.cutoff = 60),
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
library(readxl)
library(readr)
library(haven)
library(knitr)
library(kableExtra)
library(lubridate)
# Working directory saved as `wd` and data path as `data_path`  
wd <- getwd()
data_path <- str_replace(wd, "/Descriptive_Statistics", "/Data")
```

# Setting


## Room IDs & Types    

```{r room_ids}
# read "Location IDs and Areas.xlsx"
room_ids <- read_xlsx(paste0(data_path, "/NonSAS_data_files/Room_info/Location IDs and Areas.xlsx"))
# Save room_ids as .Rdata file in wd
# write_rds(room_ids, file = paste0(wd, "/room_ids.Rdata"))
names(room_ids) <- c("loc_id", "loc_id_correct", "loc_name", "space_type", "loc_sqft", "comments", "loc_area_dbl")
```

There were `r max(room_ids$loc_id_correct)` rooms in the ED categorized into `r length(unique(room_ids$space_type))` unique space types. All areas were monitored by RFID receivers. The following table shows the total area (ft^2^) designation for each type of space.   

```{r area_by_type}
room_ids %>% group_by(space_type) %>% 
  summarise(Area = sum(loc_area_dbl)) %>% 
  rename("Space Type" = space_type, "Area (sq. ft)" = Area) %>% 
  arrange(desc(`Area (sq. ft)`)) %>% 
  kable(caption = "Area of ED facility by space type")
```



# Sample

## Shifts  

(@) How were shifts selected and how many are represented in the available data?  

```{r shift_counts}
shifts_df_list <- read_rds(paste0(data_path, "/Rdata/shifts_df_list.Rdata"))
map(shifts_df_list, head)
pt_partic_byshift <- shifts_df_list[[4]]
shift_info <- shifts_df_list[[2]]
shift_info <- shift_info %>% 
  transmute(shift_num = as.character(shift_num),
         date = d8,
         shift_ampm = str_extract(str_trim(shift_num_ampm), "am|pm"),
         staffcount = as.integer(staffcount),
         patcount = as.integer(patcount),
         totcount = as.integer(total),
         cis_possible = as.integer(possiblecombs))
# Write df shift_info to .Rdata file
# write_rds(shift_info, file = "Data/Rdata/shift_info.Rdata")
kable(shift_info, col.names = c("Shift#", "Date", "AM/PM", "Staff (n)", "Patients (n)", "Total (n)", "CIs Possible"), 
      caption = "Sample counts by shift")
```

Data were generated from `r nrow(pt_partic_byshift)` shifts sampled with a stratified random method to account for day, night, and weekend shift composition. The following table shows the total number of 


## Patients 

The mean patient participation rate was `r round(mean(pt_partic_byshift$particPCT), 2)`% (n = `r round(mean(pt_partic_byshift$participant_N), 2)`).

```{r pt_demographics}
people_minutes <- read_sas("Data/person_dataset.sas7bdat")
glimpse(people_minutes)
# Minutes recorded in the ED
people_minutes %>% rename("Staff" = staff) %>% 
  group_by(Staff) %>% 
  summarise(Minimum = min(minutes),
            Maximum = max(minutes), 
            Mean = mean(minutes), 
            Median = median(minutes),
            IQR = IQR(minutes)) %>% 
  kable(caption = "Time recorded (in minutes) for staff (staff = 1) and patients (staff = 0) in all shifts")
# people_minutes %>%  mutate(staff = as_factor(staff)) %>% 
#   ggplot(mapping = aes(x = degree, y = minutes, color = shiftnum, shape = staff)) + 
#   geom_point() + scale_fill_brewer()
  
```


## Staff  

(@) What proportion of ED staff participated?

```{r staff_count}

```


(@) 

```{r patient_count}

```

(@) 

